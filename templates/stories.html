{% load static %}
<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–ö–∞–∑–∫–∏ ‚Äî IncludoLand</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/stories.css' %}">
    <script src="{% static 'js/stories.js' %}" defer></script>
</head>

<body>
    {% include 'includes/header.html' %}

    <main class="page">
        <div class="page-nav" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">
            <div class="pill-nav">
                <a class="pill pill--ghost" href="{% url 'home' %}#games" aria-label="–ù–∞–∑–∞–¥">
                    <span class="pill__ico" aria-hidden="true">‚Üê</span>
                    <span>–ù–∞–∑–∞–¥</span>
                </a>
            </div>
        </div>
        <h1 class="section-title">–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –ö–∞–∑–æ–∫</h1>

        {% if stories %}
        <section class="stories-grid" aria-label="–ö–∞–∑–∫–∏">
            {% for s in stories %}
            <article class="story-card" data-story-id="{{ s.id }}" data-title="{{ s.title|escape }}"
                data-content-type="{{ s.content_type }}"
                data-text="{% if s.content_type == 'text' %}{{ s.text|escapejs }}{% endif %}"
                data-audio-url="{{ s.audio_url }}" data-pdf-url="{{ s.pdf_url }}">
                <div class="story-card__image" {% if s.image_url %}style="background-image: url('{{ s.image_url }}');"
                    {% endif %} aria-label="{{ s.title|escape }}"></div>
                <div class="story-card__body">
                    <div class="story-card__title">{{ s.title }}</div>
                    <div class="story-card__actions">
                        {% if s.content_type == 'pdf' and s.pdf_url %}
                        <a class="pill-btn pill-btn--read" href="{{ s.pdf_url }}" target="_blank" rel="noopener">üìñ
                            –ß–∏—Ç–∞—Ç–∏</a>
                        {% else %}
                        <button class="pill-btn pill-btn--read" type="button" data-action="read">üìñ –ß–∏—Ç–∞—Ç–∏</button>
                        {% endif %}

                        {% if s.content_type == 'text' %}
                        <button class="pill-btn pill-btn--download" type="button" data-action="download-text">‚¨á
                            –¢–µ–∫—Å—Ç</button>
                        {% endif %}

                        {% if s.pdf_url %}
                        <a class="pill-btn pill-btn--download" href="{{ s.pdf_url }}" download>‚¨á PDF</a>
                        {% endif %}

                        {% if s.audio_url %}
                        <a class="pill-btn pill-btn--download" href="{{ s.audio_url }}" download>‚¨á –ê—É–¥—ñ–æ</a>
                        <button class="pill-btn pill-btn--listen" type="button" data-action="listen">üéß –°–ª—É—Ö–∞—Ç–∏</button>
                        <button class="pill-btn pill-btn--listen" type="button" data-action="pause" disabled>‚è∏
                            –ü–∞—É–∑–∞</button>
                        {% else %}
                        <button class="pill-btn pill-btn--listen" type="button" disabled>üéß –°–ª—É—Ö–∞—Ç–∏</button>
                        <button class="pill-btn pill-btn--listen" type="button" disabled>‚è∏ –ü–∞—É–∑–∞</button>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% endfor %}
        </section>
        {% else %}
        <div class="empty">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∫–∞–∑–æ–∫.</div>
        {% endif %}

        <div class="modal modal--hidden" id="story-modal" role="dialog" aria-modal="true"
            aria-labelledby="story-modal-title">
            <div class="modal__backdrop" data-action="close"></div>
            <div class="modal__panel">
                <div class="modal__header">
                    <div class="modal__title" id="story-modal-title">–ö–∞–∑–∫–∞</div>
                    <button class="modal__close" type="button" data-action="close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
                </div>
                <div class="modal__content" id="story-modal-content"></div>
            </div>
        </div>

        <section class="audio-player audio-player--hidden" id="audio-player" role="region" aria-label="–ê—É–¥—ñ–æ–ø–ª–µ—î—Ä">
            <div class="audio-player__top">
                <div class="audio-player__title" id="audio-player-title">–ê—É–¥—ñ–æ</div>
                <button class="audio-player__btn" type="button" id="audio-player-toggle" aria-label="–ü–∞—É–∑–∞">‚è∏</button>
            </div>
            <div class="audio-player__seek">
                <span class="audio-player__time" id="audio-current" aria-label="–ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å">0:00</span>
                <input class="audio-player__range" id="audio-seek" type="range" min="0" max="0" step="0.1" value="0"
                    aria-label="–ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∞—É–¥—ñ–æ" />
                <span class="audio-player__time" id="audio-duration" aria-label="–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å">0:00</span>
            </div>
        </section>

        <audio id="story-audio" preload="none"></audio>
    </main>
</body>

</html>