{% load static %}
<header class="site-header">
    <div class="site-header__inner">
        <a class="brand" href="/" aria-label="–ù–∞ –≥–æ–ª–æ–≤–Ω—É">
            <div class="brand__mark" aria-hidden="true">
                <svg viewBox="0 0 48 48" role="img" focusable="false">
                    <path d="M8 12c8 0 12 4 16 8 4-4 8-8 16-8v24c-8 0-12 4-16 8-4-4-8-8-16-8V12z" fill="#ffffff" />
                    <path d="M8 12c8 0 12 4 16 8 4-4 8-8 16-8" fill="none" stroke="#0f7aa5" stroke-width="3"
                        stroke-linecap="round" />
                </svg>
            </div>
            <div class="brand__text"><span class="brand__name">IncludoLand</span></div>
        </a>

        <div class="site-header__right">
            {% if stars %}
            <div class="status" aria-label="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                <div class="status__item">
                    <span class="status__value">{{ stars }}</span>
                    <span class="status__label">–∑—ñ—Ä–æ–∫</span>
                    <span class="status__icon" aria-hidden="true">‚òÖ</span>
                </div>
            </div>
            {% endif %}

            <nav class="pill-nav" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">
                {% if user.is_authenticated %}
                <button class="pill pill--ghost" type="button" id="nav-back" aria-label="–ù–∞–∑–∞–¥">
                    <span class="pill__ico" aria-hidden="true">‚Üê</span>
                    <span>–ù–∞–∑–∞–¥</span>
                </button>
                <span class="pill pill--user" aria-label="–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á">
                    <span class="pill__ico" aria-hidden="true">üë§</span>
                    <span>{{ user.username }}</span>
                </span>
                {% if user.specialist_profile %}
                <a class="pill" href="{% url 'specialist_profile' %}">
                    <span class="pill__ico" aria-hidden="true">üìà</span>
                    <span>–ü–∞–Ω–µ–ª—å</span>
                </a>
                <a class="pill" href="{% url 'specialist_print' %}">
                    <span class="pill__ico" aria-hidden="true">üñ®Ô∏è</span>
                    <span>–î—Ä—É–∫</span>
                </a>
                {% else %}
                <button class="pill" type="button" id="timer-pill" aria-controls="timer-popover" aria-expanded="false"
                    title="–¢–∞–π–º–µ—Ä">
                    <span class="pill__ico" aria-hidden="true">‚è±</span>
                    <span id="timer-pill-time">25:00</span>
                </button>
                <a class="pill" href="{% url 'print_hub' %}">
                    <span class="pill__ico" aria-hidden="true">üñ®Ô∏è</span>
                    <span>–î—Ä—É–∫</span>
                </a>
                <a class="pill" href="{% url 'child_profile' %}">
                    <span class="pill__ico" aria-hidden="true">üìä</span>
                    <span>–ü—Ä–æ—Ñ—ñ–ª—å</span>
                </a>
                {% endif %}
                <a class="pill" href="{% url 'logout' %}">
                    <span class="pill__ico" aria-hidden="true">‚á¶</span>
                    <span>–í–∏—Ö—ñ–¥</span>
                </a>
                {% else %}
                <a class="pill" href="{% url 'login' %}">
                    <span class="pill__ico" aria-hidden="true">‚ûú</span>
                    <span>–õ–æ–≥—ñ–Ω</span>
                </a>
                <a class="pill" href="{% url 'register' %}">
                    <span class="pill__ico" aria-hidden="true">üë•</span>
                    <span>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</span>
                </a>
                <a class="pill" href="{% url 'print_hub' %}">
                    <span class="pill__ico" aria-hidden="true">üñ®Ô∏è</span>
                    <span>–î—Ä—É–∫</span>
                </a>
                {% endif %}
            </nav>
        </div>
    </div>
</header>

<style>
    .site-header {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 24px 0;
        position: relative;
        z-index: 60;
    }

    .pill--ghost {
        background: rgba(255, 255, 255, 0.8);
        cursor: pointer;
    }

    .timer-popover {
        position: fixed;
        top: 78px;
        right: 24px;
        z-index: 200;
        width: min(340px, calc(100vw - 32px));
        background: rgba(255, 255, 255, .94);
        border: 1px solid rgba(15, 43, 58, 0.14);
        border-radius: 18px;
        box-shadow: 0 18px 52px rgba(0, 0, 0, .16);
        padding: 12px;
        backdrop-filter: blur(6px);
    }

    .timer-popover__top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
    }

    .timer-popover__title {
        font-weight: 1000;
        margin: 0;
        font-size: 14px;
    }

    .timer-popover__time {
        font-variant-numeric: tabular-nums;
        font-weight: 1000;
        font-size: 40px;
        text-align: center;
        padding: 12px 10px;
        border-radius: 16px;
        background: rgba(243, 248, 251, 0.92);
        border: 1px solid rgba(15, 43, 58, 0.10);
        margin: 8px 0 10px;
    }

    .timer-popover__meta {
        text-align: center;
        opacity: .8;
        font-weight: 800;
        font-size: 13px;
        margin-top: -4px;
    }

    .timer-popover__actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 12px;
        flex-wrap: wrap;
    }

    .timer-btn {
        border: 1px solid rgba(15, 43, 58, 0.12);
        background: #f3f8fb;
        border-radius: 14px;
        padding: 10px 12px;
        font-weight: 900;
        cursor: pointer;
        min-width: 96px;
    }

    .timer-btn--primary {
        background: linear-gradient(135deg, #3cc38a, #28a86e);
        border: 0;
        color: #fff;
    }

    .timer-btn--danger {
        background: linear-gradient(135deg, #ff6b6b, #e93a3a);
        border: 0;
        color: #fff;
    }

    .timer-toast {
        position: fixed;
        right: 24px;
        top: 78px;
        z-index: 210;
        width: min(360px, calc(100vw - 32px));
        background: rgba(255, 255, 255, .96);
        border: 1px solid rgba(15, 43, 58, 0.14);
        border-radius: 18px;
        box-shadow: 0 18px 52px rgba(0, 0, 0, .16);
        padding: 12px;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
    }

    .timer-toast__text {
        font-weight: 900;
    }

    .timer-toast__sub {
        opacity: .75;
        font-weight: 800;
        font-size: 12px;
        margin-top: 2px;
    }

    @media (max-width: 520px) {

        .timer-popover,
        .timer-toast {
            right: 16px;
            top: 66px;
        }
    }

    .site-header__inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
    }

    .site-header__right {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: flex-end;
    }

    .pill-nav {
        display: flex;
        gap: 8px;
        background: rgba(255, 255, 255, 0.86);
        border-radius: 18px;
        padding: 8px 10px;
        box-shadow: 0 6px 18px rgba(15, 43, 58, 0.08);
        border: 1px solid rgba(15, 43, 58, 0.06);
        backdrop-filter: blur(6px);
    }

    .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 14px;
        background: #f3f8fb;
        color: #0f2b3a;
        text-decoration: none;
        font-weight: 800;
        font-size: 14px;
        border: 1px solid rgba(15, 43, 58, 0.08);
        transition: background .12s ease, box-shadow .12s ease;
        white-space: nowrap;
    }

    .pill--user {
        cursor: default;
        background: rgba(255, 255, 255, 0.8);
    }

    .pill:hover {
        background: #e8f4ff;
        box-shadow: 0 3px 10px rgba(15, 43, 58, 0.08);
    }

    .pill__ico {
        font-size: 16px;
    }

    @media (max-width: 520px) {
        .site-header {
            padding: 18px 16px 0;
        }
    }
</style>

{% if user.is_authenticated and not user.specialist_profile %}
<div class="timer-popover" id="timer-popover" hidden>
    <div class="timer-popover__top">
        <h2 class="timer-popover__title">–¢–∞–π–º–µ—Ä</h2>
        <button class="pill pill--ghost" type="button" id="timer-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
    </div>

    <div class="timer-popover__time" id="timer-time">25:00</div>
    <div class="timer-popover__meta" id="timer-mode">–†–æ–±–æ—Ç–∞</div>

    <div class="timer-popover__actions">
        <button class="timer-btn timer-btn--primary" type="button" id="timer-start">–°—Ç–∞—Ä—Ç</button>
        <button class="timer-btn" type="button" id="timer-pause">–ü–∞—É–∑–∞</button>
        <button class="timer-btn timer-btn--danger" type="button" id="timer-reset">–°–∫–∏–Ω—É—Ç–∏</button>
    </div>
</div>

<div class="timer-toast" id="timer-toast" hidden role="status" aria-live="polite">
    <div>
        <div class="timer-toast__text" id="timer-toast-text">–ü–æ—Ä–∞ –≤—ñ–¥–ø–æ—á–∏—Ç–∏</div>
        <div class="timer-toast__sub">–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ —Ç–∞–π–º–µ—Ä —É –Ω–∞–≤–±–∞—Ä—ñ.</div>
    </div>
    <button class="pill pill--ghost" type="button" id="timer-toast-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
</div>

<script src="{% static 'js/pomodoro.js' %}" defer></script>
{% endif %}

<script>
    (function () {
        const btn = document.getElementById('nav-back');
        if (!btn) return;
        btn.addEventListener('click', () => {
            if (window.history.length > 1) {
                window.history.back();
                return;
            }
            window.location.href = '/';
        });
    })();
</script>