{% load static %}
<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–î–µ—Ç–∞–ª—ñ ‚Äî –ü—Ä–æ—Ñ—ñ–ª—å —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist_ml_predictions.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <script src="{% static 'js/profile_charts.js' %}" defer></script>
    <script src="{% static 'js/specialist_notes_tabs.js' %}" defer></script>
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
</head>

<body>
    <div class="shell">
        {% include 'includes/specialist_sidebar.html' with active='profile' show_helper=False %}

        <main class="main">
            <header class="top">
                <div class="top__left">
                    <a class="pill-back" href="{% url 'specialist_profile' %}">‚Üê –ù–∞–∑–∞–¥</a>
                </div>
                <div class="top__right">
                    <div class="chip chip--user">
                        <span class="chip__avatar" aria-hidden="true">üë©‚Äçüè´</span>
                        <span class="chip__text">{{ username }}</span>
                    </div>
                </div>
            </header>

            <section class="content">
                <div class="page-title">
                    <h1 class="page-title__h">–î–µ—Ç–∞–ª—ñ: {{ student.user.username }}</h1>
                </div>

                <div class="details-tabs" role="tablist" aria-label="–†–æ–∑–¥—ñ–ª–∏ –¥–µ—Ç–∞–ª–µ–π —É—á–Ω—è">
                    <button class="student-row__btn details-tab is-active" type="button" role="tab"
                        data-tab-target="stats-panel" data-default="true" aria-selected="true">
                        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </button>
                    <button class="student-row__btn details-tab" type="button" role="tab" data-tab-target="ai-panel"
                        aria-selected="false" tabindex="-1">
                        AI-–ê—Å–∏—Å—Ç–µ–Ω—Ç
                    </button>
                    <button class="student-row__btn details-tab" type="button" role="tab" data-tab-target="notes-panel"
                        aria-selected="false" tabindex="-1">
                        –ù–æ—Ç–∞—Ç–∫–∏
                    </button>
                </div>

                <div class="grid grid--single">
                    <div id="stats-panel" class="details-panel" data-tab-panel>
                        <section class="card card--full">
                            <div class="card__head">
                                <h2 class="card__title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                            </div>


                            <div class="row u-mt-16">
                                <div class="col-12 col-md-8 mx-auto mb-4">
                                    <section class="card">
                                        <div class="card__header">
                                            <h3 class="card__title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ</h3>
                                        </div>
                                        <canvas id="lineChart" height="180" data-labels='{{ line_labels|safe }}'
                                            data-datasets='{{ line_datasets|safe }}'></canvas>
                                    </section>
                                </div>

                                <div class="col-12 col-md-8 mx-auto mb-4">
                                    <section class="card">
                                        <div class="card__header">
                                            <h3 class="card__title">–ù–∞–≤–∏—á–∫–∏</h3>
                                        </div>
                                        <canvas id="radarChart" height="200" data-labels='{{ radar_labels|safe }}'
                                            data-values='{{ radar_values|safe }}'></canvas>
                                    </section>
                                </div>

                                <div class="col-12 col-md-8 mx-auto mb-4">
                                    <section class="card">
                                        <div class="card__header">
                                            <h3 class="card__title">–ü—Ä–æ–≥—Ä–µ—Å –∑–∞–≤–¥–∞–Ω—å</h3>
                                        </div>
                                        <div class="progress-list">
                                            {% for p in progress %}
                                            <div class="progress-item">
                                                <div class="progress-item__row">
                                                    <span class="progress-item__label">{{ p.label }}</span>
                                                    <span class="progress-item__value">{{ p.value }}%</span>
                                                </div>
                                                <div class="progress-item__bar" role="progressbar"
                                                    aria-valuenow="{{ p.value }}" aria-valuemin="0" aria-valuemax="100">
                                                    <div class="progress-item__fill" data-width="{{ p.value }}"></div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="ai-panel" class="details-panel" data-tab-panel hidden>
                        <section class="card card--full">
                            <div class="card__head">
                                <h2 class="card__title">AI-–ê—Å–∏—Å—Ç–µ–Ω—Ç</h2>
                            </div>

                            <div class="card__body">
                                <div class="info-box">
                                    <h3>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</h3>
                                    <p>–ê–ª–≥–æ—Ä–∏—Ç–º –º–∞—à–∏–Ω–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É—î —ñ—Å—Ç–æ—Ä—ñ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –¥–∏—Ç–∏–Ω–∏ —ñ –ø—Ä–æ–≥–Ω–æ–∑—É—î:</p>
                                    <ul>
                                        <li>–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—Å—Ç—É–ø–Ω–æ—ó —Å–ø—Ä–æ–±–∏</li>
                                        <li>–¢—Ä–µ–Ω–¥ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –Ω–∞–≤–∏—á–æ–∫</li>
                                        <li>–ü—Ä–∏–±–ª–∏–∑–Ω–∏–π —á–∞—Å –¥–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –º–∞–π—Å—Ç–µ—Ä–Ω–æ—Å—Ç—ñ (90+ –±–∞–ª—ñ–≤)</li>
                                        <li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞</li>
                                    </ul>
                                    <p><strong>–ü—Ä–∏–º—ñ—Ç–∫–∞:</strong> –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º 3-5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                                        –æ–±—Ä–∞–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.</p>
                                </div>

                                <form id="predictionForm" class="prediction-form"
                                    data-api-url="{% url 'predict_performance' %}">
                                    <div class="form-group">
                                        <label for="studentSelect">–û–±—Ä–∞–Ω–∏–π —É—á–µ–Ω—å:</label>
                                        <select id="studentSelect" name="username" required>
                                            <option value="{{ student.user.username }}" selected>
                                                {{ student.user.username }}
                                                {% if student.user.first_name %}- {{ student.user.first_name }}{% endif
                                                %}
                                            </option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="gameTypeSelect">–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:</label>
                                        <select id="gameTypeSelect" name="game_type" required>
                                            <option value="">-- –û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ --</option>
                                            {% for gt in game_types %}
                                            <option value="{{ gt.value }}">{{ gt.label }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <button type="submit" class="btn-predict">
                                        –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑
                                    </button>
                                </form>

                                <div id="loading" class="loading">
                                    <div class="spinner"></div>
                                    <p>–ê–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö —Ç–∞ –ø–æ–±—É–¥–æ–≤–∞ –ø—Ä–æ–≥–Ω–æ–∑—É...</p>
                                </div>

                                <div id="result" class="result ml-hidden"></div>
                            </div>
                        </section>
                    </div>

                    <div id="notes-panel" class="details-panel" data-tab-panel hidden>
                        <section class="card card--full">
                            <div class="card__head">
                                <h2 class="card__title">–î–æ–¥–∞—Ç–∏ –Ω–æ—Ç–∞—Ç–∫—É</h2>
                            </div>

                            <form class="note-form" method="post"
                                action="{% url 'specialist_student_notes' student.id %}">
                                {% csrf_token %}
                                <div class="note-form__field">
                                    {{ form.text }}
                                    {% if form.text.errors %}
                                    <div class="note-form__error">{{ form.text.errors|striptags }}</div>
                                    {% endif %}
                                </div>
                                <button class="student-row__btn" type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                            </form>
                        </section>

                        <section class="card card--full">
                            <div class="card__head">
                                <h2 class="card__title">–ú–æ—ó –Ω–æ—Ç–∞—Ç–∫–∏</h2>
                            </div>

                            {% if notes %}
                            <div class="note-list" aria-label="–°–ø–∏—Å–æ–∫ –Ω–æ—Ç–∞—Ç–æ–∫">
                                {% for n in notes %}
                                <div class="note">
                                    <div class="note__top">
                                        <div class="note__date">{{ n.created_at|date:"d.m.Y H:i" }}</div>
                                        <form action="{% url 'specialist_student_note_delete' n.id %}" method="post">
                                            {% csrf_token %}
                                            <button class="student-row__btn student-row__btn--danger"
                                                type="submit">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                                        </form>
                                    </div>
                                    <div class="note__text">{{ n.text|linebreaksbr }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="student-search__empty">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –Ω–æ—Ç–∞—Ç–æ–∫.</div>
                            {% endif %}
                        </section>
                    </div>
                </div>
            </section>
        </main>
    </div>
    {{ game_types|json_script:"mlGameTypes" }}
    <script src="{% static 'js/specialist_ml_predictions.js' %}"></script>
    {% include 'includes/footer.html' %}
</body>

</html>