{% load static %}
<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å ‚Äî –ü—Ä–æ—Ñ—ñ–ª—å —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist_activity_builder.css' %}">
    <script src="{% static 'js/specialist_activity_builder.js' %}" defer></script>
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
</head>

<body>
    <div class="shell">
        {% include 'includes/specialist_sidebar.html' with active=active %}

        <main class="main">
            <header class="top">
                <div class="top__left"></div>
                <div class="top__right">
                    <div class="chip chip--user">
                        <span class="chip__avatar" aria-hidden="true">üë©‚Äçüè´</span>
                        <span class="chip__text">{{ username }}</span>
                    </div>
                </div>
            </header>

            <section class="content">
                <div class="page-title">
                    <h1 class="page-title__h">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</h1>
                    <div class="page-title__sub">–ü–æ–±—É–¥—É–π—Ç–µ –ø–æ–∫—Ä–æ–∫–æ–≤–∏–π —É—Ä–æ–∫ –∑–∞ —à–∞–±–ª–æ–Ω–æ–º</div>
                </div>

                <div class="activity-grid">
                    <div class="card">
                        <div class="card__head">
                            <h2 class="card__title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</h2>
                        </div>
                        <div class="activity-list">
                            {% for item in activities %}
                            <div
                                class="activity-item{% if activity and item.id == activity.id %} activity-item--active{% endif %}">
                                <a class="activity-item__link"
                                    href="{% url 'specialist_activity_builder' %}?activity={{ item.id }}">
                                    <span class="activity-item__title">{{ item.title }}</span>
                                </a>
                                <div class="activity-item__meta">
                                    {% if item.is_active %}
                                    <span class="badge badge--active">–∞–∫—Ç–∏–≤–Ω–∞</span>
                                    {% else %}
                                    <span class="badge badge--muted">–ø–∞—É–∑–∞</span>
                                    {% endif %}
                                    <form method="post" action="{% url 'specialist_activity_delete' item.id %}">
                                        {% csrf_token %}
                                        <button class="activity-item__delete" type="submit"
                                            aria-label="–í–∏–¥–∞–ª–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å">üóë</button>
                                    </form>
                                </div>
                            </div>
                            {% empty %}
                            <div class="empty">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É.</div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__head">
                            <h2 class="card__title">{% if activity %} –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å {% else %} –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å {% endif %}
                            </h2>
                        </div>
                        <form class="s-form" method="post" action="{% url 'specialist_activity_builder' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="activity">
                            {% if activity %}
                            <input type="hidden" name="activity_id" value="{{ activity.id }}">
                            {% endif %}

                            <label class="field">
                                <span class="label">–ù–∞–∑–≤–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</span>
                                <input class="input" type="text" name="title" maxlength="160" required
                                    value="{{ activity_form.title.value|default:'' }}">
                                {% if activity_form.title.errors %}
                                <span class="error">{{ activity_form.title.errors|striptags }}</span>
                                {% endif %}
                            </label>

                            <label class="field">
                                <span class="label">–û–ø–∏—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</span>
                                <textarea class="input input--textarea" name="description"
                                    rows="3">{{ activity_form.description.value|default:'' }}</textarea>
                                {% if activity_form.description.errors %}
                                <span class="error">{{ activity_form.description.errors|striptags }}</span>
                                {% endif %}
                            </label>

                            <label class="toggle">
                                <input type="checkbox" name="is_active" {% if activity_form.is_active.value|default:True %}checked{% endif %}>
                                <span>–ê–∫—Ç–∏–≤–Ω–∞</span>
                            </label>

                            <button class="btn" type="submit">{% if activity %}–û–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å{% else %}–°—Ç–≤–æ—Ä–∏—Ç–∏
                                –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å{% endif %}</button>
                        </form>
                    </div>
                </div>

                <div class="card panel-card steps-bar">
                    <div class="panel-card__head">
                        <h2 class="panel-card__title">–°—Ü–µ–Ω–∞—Ä—ñ–π —É—Ä–æ–∫—É (–ö—Ä–æ–∫–∏)</h2>
                        {% if activity %}
                        <span class="chip chip--ghost">{{ steps|length }} –∫—Ä–æ–∫—ñ–≤</span>
                        {% endif %}
                    </div>

                    {% if not activity %}
                    <div class="panel-card__body">
                        <div class="empty">–°–ø–µ—Ä—à—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, —â–æ–± –¥–æ–¥–∞–≤–∞—Ç–∏ –∫—Ä–æ–∫–∏.</div>
                    </div>
                    {% else %}
                    <div class="panel-card__body">
                        <div class="steps-row">
                            {% for step in steps %}
                            <div class="step-pill{% if preview_step and step.id == preview_step.id %} step-pill--active{% endif %}"
                                data-title="{{ step.title|escape }}" data-description="{{ step.description|escape }}"
                                data-task="{{ step.task_text|escape }}"
                                data-image="{{ step.safe_image_url|default:'' }}"
                                data-audio="{{ step.safe_audio_url|default:'' }}">
                                <button class="step-pill__body" type="button" data-step-pill>
                                    <span class="step-pill__index">{{ forloop.counter }}.</span>
                                    <span class="step-pill__title">{{ step.title }}</span>
                                </button>
                                <div class="step-pill__actions">
                                    <a class="step-pill__edit"
                                        href="{% url 'specialist_activity_builder' %}?activity={{ activity.id }}&step={{ step.id }}"
                                        aria-label="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫—Ä–æ–∫">‚úé</a>
                                    <form method="post" action="{% url 'specialist_activity_step_delete' step.id %}">
                                        {% csrf_token %}
                                        <button class="step-pill__delete" type="submit"
                                            aria-label="–í–∏–¥–∞–ª–∏—Ç–∏ –∫—Ä–æ–∫">üóë</button>
                                    </form>
                                </div>
                            </div>
                            {% empty %}
                            <div class="empty">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π –∫—Ä–æ–∫.</div>
                            {% endfor %}
                            <a class="step-pill step-pill--add"
                                href="{% url 'specialist_activity_builder' %}?activity={{ activity.id }}">
                                + –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∫—Ä–æ–∫
                            </a>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="editor-grid">
                    <div class="card panel-card">
                        <div class="panel-card__head">
                            <h2 class="panel-card__title">–†–µ–¥–∞–∫—Ç–æ—Ä –∫—Ä–æ–∫—É{% if preview_step_index %} {{
                                preview_step_index }}: {{ preview_step.title }}{% endif %}</h2>
                        </div>

                        <div class="panel-card__body">
                            {% if not activity %}
                            <div class="empty">–û–±–µ—Ä—ñ—Ç—å –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, —â–æ–± —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫—Ä–æ–∫–∏.</div>
                            {% else %}
                            <form class="s-form" method="post" enctype="multipart/form-data"
                                action="{% url 'specialist_activity_builder' %}">
                                {% csrf_token %}
                                <input type="hidden" name="form_type" value="step">
                                <input type="hidden" name="activity_id" value="{{ activity.id }}">
                                {% if editing_step and preview_step and preview_step.id %}
                                <input type="hidden" name="step_id" value="{{ preview_step.id }}">
                                {% endif %}

                                <label class="field">
                                    <span class="label">–ù–∞–∑–≤–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</span>
                                    <input class="input" type="text" name="title" maxlength="160" required
                                        value="{{ step_form.title.value|default:'' }}">
                                    {% if step_form.title.errors %}
                                    <span class="error">{{ step_form.title.errors|striptags }}</span>
                                    {% endif %}
                                </label>

                                <label class="field">
                                    <span class="label">–û–ø–∏—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</span>
                                    <textarea class="input input--textarea" name="description"
                                        rows="2">{{ step_form.description.value|default:'' }}</textarea>
                                    {% if step_form.description.errors %}
                                    <span class="error">{{ step_form.description.errors|striptags }}</span>
                                    {% endif %}
                                </label>

                                <label class="field">
                                    <span class="label">–¢–µ–∫—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è</span>
                                    <input class="input" type="text" name="task_text" maxlength="220" required
                                        value="{{ step_form.task_text.value|default:'' }}">
                                    {% if step_form.task_text.errors %}
                                    <span class="error">{{ step_form.task_text.errors|striptags }}</span>
                                    {% endif %}
                                </label>

                                <label class="field">
                                    <span class="label">–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è</span>
                                    <input class="input input--file" type="file" name="image" accept="image/*">
                                    {% if step_form.image.errors %}
                                    <span class="error">{{ step_form.image.errors|striptags }}</span>
                                    {% endif %}
                                </label>

                                <div class="field">
                                    <span class="label">–ê—É–¥—ñ–æ</span>
                                    <div class="audio-row">
                                        <input class="input input--file" type="file" name="audio" accept="audio/*"
                                            data-audio-input>
                                        <button class="btn btn--ghost" type="button" data-audio-record>–ó–∞–ø–∏—Å–∞—Ç–∏</button>
                                    </div>
                                    <span class="hint" id="recording-status">–ú–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞–±–æ –∑–∞–ø–∏—Å–∞—Ç–∏
                                        –∞—É–¥—ñ–æ.</span>
                                </div>

                                <button class="btn" type="submit">{% if editing_step %}–ó–±–µ—Ä–µ–≥—Ç–∏ —Ü–µ–π –∫—Ä–æ–∫{% else %}–î–æ–¥–∞—Ç–∏
                                    –∫—Ä–æ–∫{% endif %}</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>

                </div>

                <div class="card panel-card preview preview--full">
                    <div class="panel-card__head">
                        <h2 class="panel-card__title">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ (–í–∏–≥–ª—è–¥ –¥–ª—è –¥–∏—Ç–∏–Ω–∏)</h2>
                    </div>

                    <div class="panel-card__body">
                        {% if preview_step %}
                        <div class="preview__grid">
                            <div class="preview__media">
                                <img id="preview-image"
                                    class="preview__image{% if not preview_step.safe_image_url %} is-hidden{% endif %}"
                                    src="{{ preview_step.safe_image_url|default:'' }}" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫—Ä–æ–∫—É">
                                <div id="preview-image-empty"
                                    class="preview__image-empty{% if preview_step.safe_image_url %} is-hidden{% endif %}">
                                    –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–µ –¥–æ–¥–∞–Ω–æ
                                </div>
                            </div>
                            <div class="preview__body">
                                <div class="preview__title" id="preview-title">{{ preview_step.title }}</div>
                                <div class="preview__desc" id="preview-description">{{
                                    preview_step.description|default:'' }}</div>
                                <div class="preview__task" id="preview-task">{{ preview_step.task_text }}</div>
                                <audio id="preview-audio"
                                    class="preview__audio{% if not preview_step.safe_audio_url %} is-hidden{% endif %}"
                                    controls src="{{ preview_step.safe_audio_url|default:'' }}"></audio>
                                <div id="preview-audio-empty"
                                    class="preview__audio-empty{% if preview_step.safe_audio_url %} is-hidden{% endif %}">
                                    –ê—É–¥—ñ–æ –Ω–µ –¥–æ–¥–∞–Ω–æ
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="empty">–°—Ç–≤–æ—Ä—ñ—Ç—å –∫—Ä–æ–∫, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥.</div>
                        {% endif %}
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>

</html>