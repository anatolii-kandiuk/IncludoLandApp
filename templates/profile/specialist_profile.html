{% load static %}
<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–ü—Ä–æ—Ñ—ñ–ª—å —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞ ‚Äî IncludoLand</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <script src="{% static 'js/specialist_charts.js' %}" defer></script>
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
</head>

<body>
    <div class="shell">
        {% include 'includes/specialist_sidebar.html' with active='profile' show_helper=True %}

        <main class="main">
            <header class="top">
                <div class="top__left"></div>
                <div class="top__right">
                    <div class="chip chip--user">
                        <span class="chip__avatar" aria-hidden="true">üë©‚Äçüè´</span>
                        <span class="chip__text">{{ username }}</span>
                    </div>
                </div>
            </header>

            <section class="content">
                <div class="page-title">
                    <h1 class="page-title__h">–ú–æ—ó –£—á–Ω—ñ</h1>
                </div>

                <div class="grid">
                    <section class="card card--full">
                        <div class="card__head">
                            <h2 class="card__title">–ú–æ—ó –£—á–Ω—ñ</h2>
                        </div>

                        {% if student_cards %}
                        <div class="pupil-list" aria-label="–°–ø–∏—Å–æ–∫ —É—á–Ω—ñ–≤">
                            {% for s in student_cards %}
                            <div class="student">
                                <div class="student__avatar" aria-hidden="true">üë¶</div>
                                <div class="student__meta">
                                    <div class="student__name">{{ s.name }}</div>
                                    <div class="student__sub">{{ s.subtitle }}</div>
                                </div>
                                <div class="student__actions">
                                    <a class="student__btn student__btn--ghost"
                                        href="{% url 'specialist_student_notes' s.id %}">–î–µ—Ç–∞–ª—ñ</a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="student-search__empty">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –¥–æ–¥–∞–Ω–∏—Ö —É—á–Ω—ñ–≤.</div>
                        {% endif %}
                    </section>

                    <section class="card card--full">
                        <div class="card__head">
                            <h2 class="card__title">–ì—Ä–∞—Ñ—ñ–∫ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ</h2>

                            <form class="chart-filters" method="get" action="{% url 'specialist_profile' %}">
                                {% if q %}<input type="hidden" name="q" value="{{ q }}">{% endif %}

                                <select class="chart-filters__control" name="perf_child" aria-label="–£—á–µ–Ω—å">
                                    <option value="all" {% if perf_child == 'all' %}selected{% endif %}>–£—Å—ñ —É—á–Ω—ñ</option>
                                    {% for s in my_students %}
                                    <option value="{{ s.id }}" {% if perf_child == s.id %}selected{% endif %}>
                                        {{ s.user.username }}</option>
                                    {% endfor %}
                                </select>

                                <select class="chart-filters__control" name="perf_game" aria-label="–ì—Ä–∞">
                                    <option value="all" {% if perf_game == 'all' %}selected{% endif %}>–£—Å—ñ —ñ–≥—Ä–∏</option>
                                    {% for value,label in perf_game_choices %}
                                    <option value="{{ value }}" {% if perf_game == value %}selected{% endif %}>{{ label }}
                                    </option>
                                    {% endfor %}
                                </select>

                                <select class="chart-filters__control" name="perf_days" aria-label="–ü–µ—Ä—ñ–æ–¥">
                                    <option value="7" {% if perf_days == 7 %}selected{% endif %}>7 –¥–Ω—ñ–≤</option>
                                    <option value="14" {% if perf_days == 14 %}selected{% endif %}>14 –¥–Ω—ñ–≤</option>
                                    <option value="30" {% if perf_days == 30 %}selected{% endif %}>30 –¥–Ω—ñ–≤</option>
                                    <option value="90" {% if perf_days == 90 %}selected{% endif %}>90 –¥–Ω—ñ–≤</option>
                                </select>
                                <button class="chart-filters__btn" type="submit">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
                            </form>
                        </div>

                        <canvas id="performanceChart" height="180" data-labels='{{ perf_labels|safe }}'
                            data-datasets='{{ perf_datasets|safe }}'></canvas>
                    </section>

                    <section class="card card--full">
                        <div class="card__head">
                            <h2 class="card__title">–ö–µ—Ä—É–≤–∞–Ω–Ω—è —É—á–Ω—è–º–∏</h2>
                        </div>

                        <details class="manage" {% if q %}open{% endif %}>
                            <summary class="manage__summary">–ü–æ—à—É–∫ / –¥–æ–¥–∞—Ç–∏ / –≤–∏–¥–∞–ª–∏—Ç–∏</summary>

                            <form class="student-search" action="{% url 'specialist_profile' %}" method="get">
                                <input class="student-search__input" type="search" name="q" value="{{ q }}"
                                    placeholder="–ü–æ—à—É–∫ –∑–∞ –ª–æ–≥—ñ–Ω–æ–º/—ñ–º º—è–º" aria-label="–ü–æ—à—É–∫ —É—á–Ω—ñ–≤">
                                <button class="student-search__btn" type="submit">–ó–Ω–∞–π—Ç–∏</button>
                            </form>

                            {% if q %}
                            <div class="student-search__results" aria-label="–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É">
                                {% if search_results %}
                                {% for s in search_results %}
                                <div class="student-row">
                                    <div class="student-row__left">
                                        <div class="student-row__avatar" aria-hidden="true">üë¶</div>
                                        <div class="student-row__meta">
                                            <div class="student-row__name">{{ s.user.username }}</div>
                                            <div class="student-row__sub">–î–∏—Ç—è—á–∏–π –ø—Ä–æ—Ñ—ñ–ª—å</div>
                                        </div>
                                    </div>
                                    <form action="{% url 'specialist_add_student' %}" method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="child_id" value="{{ s.id }}">
                                        <input type="hidden" name="next"
                                            value="{% url 'specialist_profile' %}?q={{ q|urlencode }}">
                                        <button class="student-row__btn" type="submit">–î–æ–¥–∞—Ç–∏</button>
                                    </form>
                                </div>
                                {% endfor %}
                                {% else %}
                                <div class="student-search__empty">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</div>
                                {% endif %}
                            </div>
                            {% endif %}

                            {% if my_students %}
                            <div class="student-list" aria-label="–ú–æ—ó –¥–æ–¥–∞–Ω—ñ —É—á–Ω—ñ">
                                {% for s in my_students %}
                                <div class="student-row">
                                    <div class="student-row__left">
                                        <div class="student-row__avatar" aria-hidden="true">üë¶</div>
                                        <div class="student-row__meta">
                                            <div class="student-row__name">{{ s.user.username }}</div>
                                            <div class="student-row__sub">–ó—ñ—Ä–∫–∏: {{ s.stars }}</div>
                                        </div>
                                    </div>
                                    <div class="student-row__actions">
                                        <a class="student-row__link"
                                            href="{% url 'specialist_student_notes' s.id %}">–î–µ—Ç–∞–ª—ñ</a>
                                        <form action="{% url 'specialist_remove_student' s.id %}" method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="next" value="{% url 'specialist_profile' %}">
                                            <button class="student-row__btn student-row__btn--danger"
                                                type="submit">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                                        </form>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </details>
                    </section>
                </div>
            </section>
        </main>
    </div>
    {% include 'includes/footer.html' %}
</body>

</html>