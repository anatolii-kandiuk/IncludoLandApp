{% load static %}
<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–∞–∑–∫–∞–º–∏ ‚Äî –ü—Ä–æ—Ñ—ñ–ª—å —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist.css' %}">
    <link rel="stylesheet" href="{% static 'css/specialist_stories.css' %}">
    <script src="{% static 'js/specialist_stories.js' %}" defer></script>
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
</head>

<body>
    <div class="shell">
        {% include 'includes/specialist_sidebar.html' with active='stories' %}

        <main class="main">
            <header class="top">
                <div class="top__left"></div>
                <div class="top__right">
                    <div class="chip chip--user">
                        <span class="chip__avatar" aria-hidden="true">üë©‚Äçüè´</span>
                        <span class="chip__text">{{ username }}</span>
                    </div>
                </div>
            </header>

            <section class="content">
                <div class="page-title">
                    <h1 class="page-title__h">–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–∞–∑–∫–∞–º–∏</h1>
                </div>

                <div class="stories">
                    <section class="panel">
                        <h2 class="panel__title" id="form-title">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –∫–∞–∑–∫—É</h2>

                        <form class="story-form" id="story-form" method="post" enctype="multipart/form-data"
                            action="{% url 'specialist_stories' %}" data-create-action="{% url 'specialist_stories' %}"
                            data-edit-url-template="{% url 'specialist_story_edit' 0 %}"
                            data-edit-story-id="{% if edit_story_id %}{{ edit_story_id }}{% endif %}">
                            {% csrf_token %}

                            <label class="field">
                                <span class="field__label">–ù–∞–∑–≤–∞ –∫–∞–∑–∫–∏</span>
                                <input class="field__input" id="id_title" name="title" type="text" maxlength="120"
                                    required value="{{ form.title.value|default:'' }}">
                            </label>

                            <label class="drop" for="id_image">
                                <input class="drop__input" id="id_image" name="image" type="file" accept="image/*">
                                <span class="drop__box">
                                    <span class="drop__icon" aria-hidden="true">üñºÔ∏è</span>
                                    <span class="drop__text" id="image-drop-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</span>
                                </span>
                            </label>

                            <div class="type">
                                <div class="type__label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç—É</div>
                                <div class="type__row" role="radiogroup" aria-label="–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç—É">
                                    <label class="radio">
                                        <input type="radio" name="content_type" value="text" id="ct_text" {% if
                                            form.content_type.value|default:'text' == 'text' %} checked {% endif %}>
                                        <span>–í—Å—Ç–∞–≤–∏—Ç–∏ —Ç–µ–∫—Å—Ç</span>
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="content_type" value="pdf" id="ct_pdf" {% if
                                            form.content_type.value == 'pdf' %} checked {% endif %}>
                                        <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</span>
                                    </label>
                                </div>
                            </div>

                            <div class="content-box" id="box-text">
                                <textarea class="textarea" id="id_text"
                                    name="text">{{ form.text.value|default:'' }}</textarea>
                            </div>

                            <div class="content-box content-box--hidden" id="box-pdf">
                                <label class="drop" for="id_pdf_file">
                                    <input class="drop__input" id="id_pdf_file" name="pdf_file" type="file"
                                        accept="application/pdf">
                                    <span class="drop__box">
                                        <span class="drop__icon" aria-hidden="true">üìÑ</span>
                                        <span class="drop__text" id="pdf-drop-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</span>
                                    </span>
                                </label>
                            </div>

                            <div class="current current--hidden" id="current-media" aria-label="–ü–æ—Ç–æ—á–Ω—ñ —Ñ–∞–π–ª–∏">
                                <div class="current__meta">
                                    <div class="current__label">–ü–æ—Ç–æ—á–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</div>
                                    <div class="current__thumb" id="current-image"></div>
                                </div>
                                <div class="current__meta">
                                    <div class="current__label">–ü–æ—Ç–æ—á–Ω–∏–π PDF:</div>
                                    <a class="current__link" id="current-pdf" href="#" target="_blank"
                                        rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
                                </div>
                                <div class="current__meta">
                                    <div class="current__label">–ü–æ—Ç–æ—á–Ω–∏–π –∞—É–¥—ñ–æ—Å—É–ø—Ä–æ–≤—ñ–¥:</div>
                                    <audio class="current__audio" id="current-audio" controls></audio>
                                </div>
                            </div>

                            <div class="audio">
                                <div class="audio__label">–ê—É–¥—ñ–æ—Å—É–ø—Ä–æ–≤—ñ–¥</div>
                                <button class="record" id="record-btn" type="button">üéô –ó–∞–ø–∏—Å–∞—Ç–∏ –∞—É–¥—ñ–æ <span
                                        id="record-time">(00:00)</span></button>

                                <label class="upload" for="id_audio">
                                    <input class="upload__input" id="id_audio" name="audio" type="file"
                                        accept="audio/*">
                                    <span class="upload__btn" id="audio-upload-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞—É–¥—ñ–æ—Ñ–∞–π–ª</span>
                                </label>

                                <audio class="audio__preview" id="audio-preview" controls></audio>
                            </div>

                            <div class="actions">
                                <button class="save" id="save-btn" type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–∞–∑–∫—É</button>
                                <button class="cancel cancel--hidden" id="cancel-edit" type="button">–°–∫–∞—Å—É–≤–∞—Ç–∏
                                    —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</button>
                            </div>

                            {% if form.errors %}
                            <div class="form-errors" role="alert">
                                {{ form.errors }}
                            </div>
                            {% endif %}
                        </form>
                    </section>

                    <section class="panel">
                        <h2 class="panel__title">–°–ø–∏—Å–æ–∫ –∫–∞–∑–æ–∫</h2>

                        {% if stories %}
                        <div class="story-list" aria-label="–°–ø–∏—Å–æ–∫ –∫–∞–∑–æ–∫">
                            {% for s in stories %}
                            <div class="story-item" data-story-id="{{ s.id }}" data-title="{{ s.title|escape }}"
                                data-content-type="{{ s.content_type }}"
                                data-text="{% if s.content_type == 'text' %}{{ s.text|escapejs }}{% endif %}"
                                data-image-url="{{ s.safe_image_url }}" data-pdf-url="{{ s.safe_pdf_url }}"
                                data-audio-url="{{ s.safe_audio_url }}">

                                <div class="story-item__main">
                                    {% if s.safe_image_url %}
                                    <div class="story-item__thumb" data-bg-image="{{ s.safe_image_url }}"></div>
                                    {% endif %}
                                    <div class="story-item__title">{{ s.title }}</div>
                                    <div class="story-item__meta">
                                        {% if s.content_type == 'pdf' and s.safe_pdf_url %}
                                        <a class="icon" href="{{ s.safe_pdf_url }}" target="_blank" rel="noopener"
                                            title="–í—ñ–¥–∫—Ä–∏—Ç–∏ PDF">PDF</a>
                                        {% elif s.content_type == 'text' %}
                                        <span class="icon" title="–¢–µ–∫—Å—Ç">TXT</span>
                                        {% else %}
                                        <span class="icon icon--muted" title="–§–∞–π–ª –≤—ñ–¥—Å—É—Ç–Ω—ñ–π">PDF</span>
                                        {% endif %}
                                        <button class="icon icon--audio" type="button" title="–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏" {% if not
                                            s.safe_audio_url %} disabled {% endif %}>üîä</button>
                                    </div>
                                </div>

                                <div class="story-item__actions">
                                    <button class="btn btn--edit" type="button">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                    <form method="post" action="{% url 'specialist_story_delete' s.id %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="next" value="{% url 'specialist_stories' %}">
                                        <button class="btn btn--danger" type="submit"
                                            data-confirm="–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞–∑–∫—É ¬´{{ s.title|escapejs }}¬ª?">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∫–∞–∑–æ–∫.</div>
                        {% endif %}
                    </section>
                </div>
            </section>
        </main>
    </div>
    {% include 'includes/footer.html' %}
</body>

</html>